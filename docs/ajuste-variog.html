<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.3 Ajuste de un modelo válido | Estadística Espacial con R</title>
  <meta name="description" content="Apuntes de Estadística Espacial (para las asignaturas: ‘Análisis estadístico de datos con dependencia’ del Grado en Ciencia e Ingeniería de Datos y ‘Aprendizaje estadístico’ del Máster InterUniversitario en Técnicas Estadísticas)." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3.3 Ajuste de un modelo válido | Estadística Espacial con R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Apuntes de Estadística Espacial (para las asignaturas: ‘Análisis estadístico de datos con dependencia’ del Grado en Ciencia e Ingeniería de Datos y ‘Aprendizaje estadístico’ del Máster InterUniversitario en Técnicas Estadísticas)." />
  <meta name="github-repo" content="rubenfcasal/estadistica_espacial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.3 Ajuste de un modelo válido | Estadística Espacial con R" />
  
  <meta name="twitter:description" content="Apuntes de Estadística Espacial (para las asignaturas: ‘Análisis estadístico de datos con dependencia’ del Grado en Ciencia e Ingeniería de Datos y ‘Aprendizaje estadístico’ del Máster InterUniversitario en Técnicas Estadísticas)." />
  

<meta name="author" content="Rubén Fernández Casal (MODES, CITIC, UDC; ruben.fcasal@udc.es)" />
<meta name="author" content="Tomás Cotos Yáñez (SIDOR, UVIGO; cotos@uvigo.es)" />


<meta name="date" content="2021-11-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modelos-variog.html"/>
<link rel="next" href="kriging.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Estadística Espacial con R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prólogo</a></li>
<li class="chapter" data-level="1" data-path="intro-estesp.html"><a href="intro-estesp.html"><i class="fa fa-check"></i><b>1</b> Introducción: Procesos espaciales y Geoestadística</a>
<ul>
<li class="chapter" data-level="1.1" data-path="proc-esp.html"><a href="proc-esp.html"><i class="fa fa-check"></i><b>1.1</b> Procesos espaciales</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="proc-esp.html"><a href="proc-esp.html#paquetes-r"><i class="fa fa-check"></i><b>1.1.1</b> Paquetes de R</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="geoestadistica.html"><a href="geoestadistica.html"><i class="fa fa-check"></i><b>1.2</b> Geoestadística</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="geoestadistica.html"><a href="geoestadistica.html#modelos-clasicos-espaciales"><i class="fa fa-check"></i><b>1.2.1</b> Modelos clásicos y modelos espaciales</a></li>
<li class="chapter" data-level="1.2.2" data-path="geoestadistica.html"><a href="geoestadistica.html#ventajas-de-la-aproximación-espacial-y-espacio-temporal"><i class="fa fa-check"></i><b>1.2.2</b> Ventajas de la aproximación espacial (y espacio-temporal)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="procesos-estacionarios.html"><a href="procesos-estacionarios.html"><i class="fa fa-check"></i><b>1.3</b> Procesos espaciales estacionarios</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="procesos-estacionarios.html"><a href="procesos-estacionarios.html#propiedades-elementales"><i class="fa fa-check"></i><b>1.3.1</b> Propiedades elementales del covariograma y del variograma</a></li>
<li class="chapter" data-level="1.3.2" data-path="procesos-estacionarios.html"><a href="procesos-estacionarios.html#procesos-agregados"><i class="fa fa-check"></i><b>1.3.2</b> Procesos agregados</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="objetivos-esquema.html"><a href="objetivos-esquema.html"><i class="fa fa-check"></i><b>1.4</b> Objetivos y pasos</a></li>
<li class="chapter" data-level="1.5" data-path="el-paquete-gstat.html"><a href="el-paquete-gstat.html"><i class="fa fa-check"></i><b>1.5</b> El paquete <strong>gstat</strong></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="datos.html"><a href="datos.html"><i class="fa fa-check"></i><b>2</b> Datos espaciales</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datos-tipos.html"><a href="datos-tipos.html"><i class="fa fa-check"></i><b>2.1</b> Tipos de datos espaciales</a></li>
<li class="chapter" data-level="2.2" data-path="sf-intro.html"><a href="sf-intro.html"><i class="fa fa-check"></i><b>2.2</b> Introducción al paquete <strong>sf</strong></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="sf-intro.html"><a href="sf-intro.html#crs"><i class="fa fa-check"></i><b>2.2.1</b> Sistemas de referencia de coordenadas</a></li>
<li class="chapter" data-level="2.2.2" data-path="sf-intro.html"><a href="sf-intro.html#tidyverse-sf"><i class="fa fa-check"></i><b>2.2.2</b> Integración con el ecosistema <strong>tidyverse</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="representación-de-datos-espaciales.html"><a href="representación-de-datos-espaciales.html"><i class="fa fa-check"></i><b>2.3</b> Representación de datos espaciales</a></li>
<li class="chapter" data-level="2.4" data-path="operaciones-datos.html"><a href="operaciones-datos.html"><i class="fa fa-check"></i><b>2.4</b> Operaciones con datos espaciales</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="operaciones-datos.html"><a href="operaciones-datos.html#importación-y-exportación-de-datos-espaciales"><i class="fa fa-check"></i><b>2.4.1</b> Importación y exportación de datos espaciales</a></li>
<li class="chapter" data-level="2.4.2" data-path="operaciones-datos.html"><a href="operaciones-datos.html#operaciones-con-geometrías"><i class="fa fa-check"></i><b>2.4.2</b> Operaciones con geometrías</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="sp-eda.html"><a href="sp-eda.html"><i class="fa fa-check"></i><b>2.5</b> Análisis exploratorio de datos espaciales</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modelado.html"><a href="modelado.html"><i class="fa fa-check"></i><b>3</b> Modelado de procesos geoestadísticos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vario-muestrales.html"><a href="vario-muestrales.html"><i class="fa fa-check"></i><b>3.1</b> Estimadores muestrales del semivariograma</a></li>
<li class="chapter" data-level="3.2" data-path="modelos-variog.html"><a href="modelos-variog.html"><i class="fa fa-check"></i><b>3.2</b> Modelos de semivariogramas</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="modelos-variog.html"><a href="modelos-variog.html#modelos-parametricos"><i class="fa fa-check"></i><b>3.2.1</b> Modelos paramétricos isotrópicos</a></li>
<li class="chapter" data-level="3.2.2" data-path="modelos-variog.html"><a href="modelos-variog.html#anisotropia"><i class="fa fa-check"></i><b>3.2.2</b> Modelado de anisotropía</a></li>
<li class="chapter" data-level="3.2.3" data-path="modelos-variog.html"><a href="modelos-variog.html#vario-lin-reg"><i class="fa fa-check"></i><b>3.2.3</b> El modelo lineal de regionalización</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ajuste-variog.html"><a href="ajuste-variog.html"><i class="fa fa-check"></i><b>3.3</b> Ajuste de un modelo válido</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="ajuste-variog.html"><a href="ajuste-variog.html#ls-fit"><i class="fa fa-check"></i><b>3.3.1</b> Estimación por mínimos cuadrados</a></li>
<li class="chapter" data-level="3.3.2" data-path="ajuste-variog.html"><a href="ajuste-variog.html#trend-fit"><i class="fa fa-check"></i><b>3.3.2</b> Modelado del variograma en procesos no estacionarios</a></li>
<li class="chapter" data-level="3.3.3" data-path="ajuste-variog.html"><a href="ajuste-variog.html#ml-fit"><i class="fa fa-check"></i><b>3.3.3</b> Estimación por máxima verosimilitud</a></li>
<li class="chapter" data-level="3.3.4" data-path="ajuste-variog.html"><a href="ajuste-variog.html#comentarios-sobre-los-distintos-métodos"><i class="fa fa-check"></i><b>3.3.4</b> Comentarios sobre los distintos métodos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="kriging.html"><a href="kriging.html"><i class="fa fa-check"></i><b>4</b> Predicción Kriging</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introducción.html"><a href="introducción.html"><i class="fa fa-check"></i><b>4.1</b> Introducción</a></li>
<li class="chapter" data-level="4.2" data-path="ksimple.html"><a href="ksimple.html"><i class="fa fa-check"></i><b>4.2</b> Kriging con media conocida: kriging simple</a></li>
<li class="chapter" data-level="4.3" data-path="kuniversal.html"><a href="kuniversal.html"><i class="fa fa-check"></i><b>4.3</b> Kriging con media desconocida: kriging universal y kriging residual</a></li>
<li class="chapter" data-level="4.4" data-path="consideraciones-kriging.html"><a href="consideraciones-kriging.html"><i class="fa fa-check"></i><b>4.4</b> Consideraciones acerca de los métodos kriging</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivar.html"><a href="multivar.html"><i class="fa fa-check"></i><b>5</b> Procesos espaciales multivariantes</a></li>
<li class="chapter" data-level="6" data-path="esp-temp.html"><a href="esp-temp.html"><i class="fa fa-check"></i><b>6</b> Procesos espaciales espacio-temporales</a></li>
<li class="appendix"><span><b>Apendices</b></span></li>
<li class="chapter" data-level="A" data-path="intro-sp.html"><a href="intro-sp.html"><i class="fa fa-check"></i><b>A</b> Introducción al paquete <strong>sp</strong></a>
<ul>
<li class="chapter" data-level="A.1" data-path="tipos-de-objetos.html"><a href="tipos-de-objetos.html"><i class="fa fa-check"></i><b>A.1</b> Tipos de objetos</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="tipos-de-objetos.html"><a href="tipos-de-objetos.html#spatialpoints-y-spatialpointsdataframe"><i class="fa fa-check"></i><b>A.1.1</b> SpatialPoints y SpatialPointsDataFrame</a></li>
<li class="chapter" data-level="A.1.2" data-path="tipos-de-objetos.html"><a href="tipos-de-objetos.html#spatiallines-y-spatialpolygons"><i class="fa fa-check"></i><b>A.1.2</b> SpatialLines y SpatialPolygons</a></li>
<li class="chapter" data-level="A.1.3" data-path="tipos-de-objetos.html"><a href="tipos-de-objetos.html#spatialgrid-y-spatialpixels"><i class="fa fa-check"></i><b>A.1.3</b> SpatialGrid y SpatialPixels</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="métodos-y-procedimientos-clases-sp.html"><a href="métodos-y-procedimientos-clases-sp.html"><i class="fa fa-check"></i><b>A.2</b> Métodos y procedimientos clases sp</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="métodos-y-procedimientos-clases-sp.html"><a href="métodos-y-procedimientos-clases-sp.html#importarexportartransformar"><i class="fa fa-check"></i><b>A.2.1</b> Importar/exportar/transformar</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="representaciones-gráficas.html"><a href="representaciones-gráficas.html"><i class="fa fa-check"></i><b>A.3</b> Representaciones gráficas</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="representaciones-gráficas.html"><a href="representaciones-gráficas.html#gráficos-estándar"><i class="fa fa-check"></i><b>A.3.1</b> Gráficos estándar</a></li>
<li class="chapter" data-level="A.3.2" data-path="representaciones-gráficas.html"><a href="representaciones-gráficas.html#gráficos-lattice-spplot"><i class="fa fa-check"></i><b>A.3.2</b> Gráficos lattice: spplot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="intro-geoR.html"><a href="intro-geoR.html"><i class="fa fa-check"></i><b>B</b> Introducción al paquete <strong>geoR</strong></a>
<ul>
<li class="chapter" data-level="B.1" data-path="inicio-de-una-sesión-y-de-carga-de-datos.html"><a href="inicio-de-una-sesión-y-de-carga-de-datos.html"><i class="fa fa-check"></i><b>B.1</b> Inicio de una sesión y de carga de datos</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="inicio-de-una-sesión-y-de-carga-de-datos.html"><a href="inicio-de-una-sesión-y-de-carga-de-datos.html#archivos-de-datos"><i class="fa fa-check"></i><b>B.1.1</b> Archivos de datos</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="análisis-descriptivo-de-datos-geoestadísticos.html"><a href="análisis-descriptivo-de-datos-geoestadísticos.html"><i class="fa fa-check"></i><b>B.2</b> Análisis descriptivo de datos geoestadísticos</a></li>
<li class="chapter" data-level="B.3" data-path="modelado-de-la-dependencia.html"><a href="modelado-de-la-dependencia.html"><i class="fa fa-check"></i><b>B.3</b> Modelado de la dependencia</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="modelado-de-la-dependencia.html"><a href="modelado-de-la-dependencia.html#variogramas-empíricos"><i class="fa fa-check"></i><b>B.3.1</b> Variogramas empíricos</a></li>
<li class="chapter" data-level="B.3.2" data-path="modelado-de-la-dependencia.html"><a href="modelado-de-la-dependencia.html#ajuste-de-un-modelo-de-variograma"><i class="fa fa-check"></i><b>B.3.2</b> Ajuste de un modelo de variograma</a></li>
<li class="chapter" data-level="B.3.3" data-path="modelado-de-la-dependencia.html"><a href="modelado-de-la-dependencia.html#inferencia-sobre-el-variograma"><i class="fa fa-check"></i><b>B.3.3</b> Inferencia sobre el variograma</a></li>
<li class="chapter" data-level="B.3.4" data-path="modelado-de-la-dependencia.html"><a href="modelado-de-la-dependencia.html#estimación-del-variograma-en-procesos-no-estacionarios"><i class="fa fa-check"></i><b>B.3.4</b> Estimación del variograma en procesos no estacionarios</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="predicción-espacial-kriging.html"><a href="predicción-espacial-kriging.html"><i class="fa fa-check"></i><b>B.4</b> Predicción espacial (kriging)</a>
<ul>
<li class="chapter" data-level="B.4.1" data-path="predicción-espacial-kriging.html"><a href="predicción-espacial-kriging.html#validación-cruzada"><i class="fa fa-check"></i><b>B.4.1</b> Validación cruzada</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a>
<ul>
<li class="chapter" data-level="" data-path="bibliografía-completa.html"><a href="bibliografía-completa.html"><i class="fa fa-check"></i>Bibliografía completa</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Estadística Espacial con R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ajuste-variog" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Ajuste de un modelo válido</h2>
<p>Como ya se comentó anteriormente, en general los estimadores del variograma no pueden ser usados directamente en la predicción espacial;
no son condicionalmente semidefinidos negativos y eso puede causar por ejemplo sistemas kriging inválidos o estimaciones negativas de la varianza kriging.
Este problema normalmente se remedia buscando un modelo paramétrico válido que describa adecuadamente la dependencia espacial presente en los datos.
Supongamos que <span class="math inline">\(P=\left\{ 2\gamma(\mathbf{h};\boldsymbol{\theta}):\boldsymbol{\theta}\in \Theta \right\}\)</span>, donde <span class="math inline">\(2\gamma(\mathbf{h};\boldsymbol{\theta})\)</span> es un variograma válido en <span class="math inline">\(\mathbb{R}^{d}\)</span> (normalmente isotrópico), es la familia parametrizada de variogramas escogida.
Se trata de encontrar el mejor elemento de <span class="math inline">\(P\)</span>, para lo que se han propuesto diversos criterios de bondad de ajuste (ver p.e. Cressie, 1993, Sección 2.6).
Entre ellos hay que destacar los basados en mínimos cuadrados y en máxima verosimilitud, descritos a continuación.</p>
<div id="ls-fit" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Estimación por mínimos cuadrados</h3>
<p>Supongamos que <span class="math inline">\(2\gamma(\mathbf{h};\boldsymbol{\theta}_{0})\)</span> es el variograma teórico y que <span class="math inline">\(\hat{\gamma}_{i} =\hat{\gamma}(\mathbf{h}_{i})\)</span>, <span class="math inline">\(i = 1,\ldots,K\)</span>, son las estimaciones del semivariograma obtenidas utilizando algún tipo de estimador piloto (p.e. alguno de los mostrados en la Sección 4.1.1).
Normalmente, siguiendo las recomendaciones sugeridas por Journel y Huijbregts (1978, p. 194), solamente se consideran en el ajuste saltos menores o iguales que la mitad del máximo salto (i.e. <span class="math inline">\(\left\| \mathbf{h}_{i} \right\| \leq \frac{1}{2} \max \left\{ \left\| \mathbf{s}_{k} -\mathbf{s}_{l} \right\| \right\}\)</span>); y, si se utiliza el estimador empírico (o uno similar), de forma que el número de aportaciones a cada estimación sea por lo menos de treinta (i.e. <span class="math inline">\(\left| N(\mathbf{h}_{i})\right| \geq 30\)</span>).
Habitualmente (e.g. Cressie, 1993, p. 96-97) la estimación por mínimos cuadrados de <span class="math inline">\(\boldsymbol{\theta}_{0}\)</span> se obtiene al minimizar:
<span class="math display" id="eq:ls-obj">\[\begin{equation} 
  \left( \hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta})\right)^{\top } \mathbf{V}(\boldsymbol{\theta})\left( \hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta})\right),
  \tag{3.3}
\end{equation}\]</span>
<!-- \@ref(eq:ls-obj) -->
siendo <span class="math inline">\(\hat{\boldsymbol{\gamma}} =(\hat{\gamma}(\mathbf{h}_1),\ldots,\hat{\gamma} (\mathbf{h}_{K}))^\top\)</span>, <span class="math inline">\(\boldsymbol{\gamma}(\boldsymbol{\theta})=(\gamma(\mathbf{h}_1 ;\boldsymbol{\theta}),\ldots,\gamma(\mathbf{h}_{K} ;\boldsymbol{\theta}))^\top\)</span>
y <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})\)</span> una matriz <span class="math inline">\(K\times K\)</span> semidefinida positiva que puede
depender de <span class="math inline">\(\boldsymbol{\theta}\)</span>, considerando alguno de los siguientes casos:</p>
<ul>
<li><p>Mínimos cuadrados ordinarios (OLS): <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta}) = \mathbf{I}_{K}\)</span>,
la matriz identidad <span class="math inline">\(K\times K\)</span>.</p></li>
<li><p>Mínimos cuadrados ponderados (WLS): <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta}) = \text{diag}(w_1 (\boldsymbol{\theta}),\ldots,w_{K}(\boldsymbol{\theta}))\)</span>,
con <span class="math inline">\(w_{i}(\boldsymbol{\theta})\geq 0\)</span>, <span class="math inline">\(i=1,\ldots,K\)</span>.
Normalmente se suele tomar estos pesos inversamente proporcionales a <span class="math inline">\(Var(\hat{\gamma}(\mathbf{h}_{i}))\)</span>.</p></li>
<li><p>Mínimos cuadrados generalizados (GLS): <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})=\Sigma_{\hat{\boldsymbol{\gamma}}} (\boldsymbol{\theta})^{-1}\)</span>,
la inversa de la matriz de covarianzas (asintótica) de <span class="math inline">\(\hat{\boldsymbol{\gamma}}\)</span> obtenida suponiendo que el variograma teórico es <span class="math inline">\(2\gamma(\mathbf{h};\boldsymbol{\theta})\)</span>.</p></li>
</ul>
<p>Es importante señalar que al utilizar el criterio GLS el cálculo de la matriz de covarianzas <span class="math inline">\(\Sigma_{\hat{\boldsymbol{\gamma}}} (\boldsymbol{\theta})\)</span> generalmente no resulta fácil (por ejemplo en Cressie 1993, p. 96, se tienen las expresiones para el estimador empírico y el estimador robusto, suponiendo normalidad).
Esto produce que la minimización de la función objetivo <a href="ajuste-variog.html#eq:ls-obj">(3.3)</a> sea computacionalmente prohibitiva en muchos casos.
El método de mínimos cuadrados ponderados puede verse como un compromiso entre la eficiencia del método de GLS y la simplicidad del método de OLS.
Además, suponiendo normalidad y que el variograma teórico es <span class="math inline">\(2\gamma(\mathbf{h};\boldsymbol{\theta})\)</span>, Cressie (1985) probó que:
<span class="math display">\[Var(\hat{\gamma}(\mathbf{h}_{i}))\simeq 2\dfrac{\gamma(\mathbf{h}_{i}
;\boldsymbol{\theta})^2 }{\left| N(\mathbf{h}_{i})\right| },\]</span>
en el caso del estimador empírico; y para el estimador robusto:
<span class="math display">\[Var(\tilde{\gamma}(\mathbf{h}_{i}))\simeq 2.885\dfrac{\gamma
(\mathbf{h}_{i} ;\boldsymbol{\theta})^2 }{\left| N(\mathbf{h}_{i})\right| },\]</span>
siendo esta aproximación incluso mejor que en el caso anterior.
Proponiendo en estos casos la minimización de:
<span class="math display">\[\sum\limits_{i=1}^{K} w_{i}(\boldsymbol{\theta}) \left( \hat{\gamma}(\mathbf{h}_{i}) - \gamma(\mathbf{h}_{i};\boldsymbol{\theta}) \right)^2,\]</span>
siendo <span class="math inline">\(w_{i}(\boldsymbol{\theta}) = \left| N(\mathbf{h}_{i})\right| /\gamma(\mathbf{h}_{i} ;\boldsymbol{\theta})^2\)</span>, como aproximación al criterio WLS.</p>
<p>Estos métodos de ajuste tiene unas propiedades interesantes, cuanto mayor sea <span class="math inline">\(\left| N(\mathbf{h}_{i})\right|\)</span> mayor peso recibe el residuo en el salto <span class="math inline">\(\mathbf{h}_{i}\)</span> y además, cuanto más pequeño sea el valor del variograma teórico mayor peso recibe también el residuo correspondiente.
Por este motivo, los saltos próximos al origen típicamente reciben mayor peso con lo que se consigue un buen ajuste del modelo de variograma cerca del origen (esto es especialmente importante; ver p.e. Stein, 1988, y comentarios en la Sección 4.X).
Adicionalmente estos métodos pueden ser implementados fácilmente en la práctica (de forma similar al OLS).</p>
<p>Aunque para obtener las expresiones (o aproximaciones) de las varianzas y covarianzas de las estimaciones piloto se supone habitualmente que la distribución de los datos es normal, se puede probar fácilmente que los procedimientos de ajuste obtenidos son también válidos para el caso de datos normales transformados (ver p.e. Cressie, 1993, p. 98).
Esta es una de las principales ventajas de los métodos WLS o GLS frente a otras alternativas (como los métodos basados en máxima verosimilitud); como utilizan solamente la estructura de segundo orden (asintótica) del estimador del variograma, no es necesario hacer suposiciones sobre la distribución completa de los datos<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>.</p>
<p>Como comentario final, en la función objetivo <a href="ajuste-variog.html#eq:ls-obj">(3.3)</a> de los criterios WLS y GLS anteriores, la matriz de pesos utilizada en el ajuste <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})\)</span> depende también del parámetro sobre el que se realiza la minimización (y al minimizar <a href="ajuste-variog.html#eq:ls-obj">(3.3)</a> en cierto sentido se están maximizando también las varianzas), por lo que puede ser preferible utilizar un algoritmo iterativo.
Por ejemplo comenzar con pesos OLS (o WLS con <span class="math inline">\(w_{i} = \left| N(\mathbf{h}_{i})\right| / \| \mathbf{h}_{i} \|^2\)</span>) y posteriormente en cada etapa <span class="math inline">\(k\)</span> obtener una nueva aproximación <span class="math inline">\(\hat{\boldsymbol{\theta}}_{0}^{(k)}\)</span> al minimizar:
<span class="math display">\[\left( \hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta})\right)^{\top } \mathbf{V}(\hat{\boldsymbol{\theta}}_{0}^{(k-1)})\left( \hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta})\right),\]</span>
repitiendo este proceso hasta convergencia (realmente muchos de los algoritmos diseñados para el ajuste por mínimos cuadrados proceden de esta forma).</p>
<p>En <code>gstat</code> el ajuste OLS y WLS se realiza mediante la función:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ajuste-variog.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.variogram</span>(object, model, <span class="at">fit.sills =</span> <span class="cn">TRUE</span>, <span class="at">fit.ranges =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-2"><a href="ajuste-variog.html#cb93-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">fit.method =</span> <span class="dv">7</span>, <span class="at">fit.kappa =</span> <span class="cn">FALSE</span>, ...)</span></code></pre></div>
<ul>
<li><p><code>object</code>: semivariograma empírico, obtenido con la función <code>variogram()</code>.</p></li>
<li><p><code>model</code>: modelo de semivariograma, generado con la función <code>vgm()</code>.</p></li>
<li><p><code>fit.sills</code>, <code>fit.ranges</code>, <code>fit.kappa</code>: determinan si se ajustan los correspondientes parámetros (<code>TRUE</code>) o se mantienen fijos (<code>FALSE</code>).</p></li>
<li><p><code>fit.method</code>: selección de los pesos en el criterio WLS.</p>
<ul>
<li><code>fit.method = 6</code>: <span class="math inline">\(w_{i} = 1\)</span>, OLS.</li>
<li><code>fit.method = 1</code>: <span class="math inline">\(w_{i} = \left| N(\mathbf{h}_{i})\right|\)</span>.</li>
<li><code>fit.method = 7</code>: <span class="math inline">\(w_{i} = \left| N(\mathbf{h}_{i})\right| / \| \mathbf{h}_{i} \|^2\)</span>.</li>
<li><code>fit.method = 2</code>: <span class="math inline">\(w_{i} = \left| N(\mathbf{h}_{i})\right| /\gamma(\mathbf{h}_{i} ;\boldsymbol{\theta})^2\)</span>.</li>
</ul></li>
</ul>
<p>Los parámetros iniciales se fijan a los establecidos en <code>model</code>. Si alguno es desconocido (<code>NA</code>), le asigna un valor por defecto:</p>
<ul>
<li>el rango se establece a 1/3 de la distancia máxima del variograma empírico,</li>
<li>al umbral parcial se le asigna el promedio de los últimos 5 valores del variograma empírico,</li>
<li>y el efecto nugget (siempre que haya sido establecido explícitamente con <code>nugget = NA</code>) se toma como la media de los tres primeros valores del variograma empírico.</li>
</ul>
<p>Como ejemplo, a continuación se ajusta un modelo exponencial al variograma empírico calculado en la Sección <a href="vario-muestrales.html#vario-muestrales">3.1</a>, mediante OLS y WLS con diferentes pesos:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="ajuste-variog.html#cb94-1" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Exp&quot;</span>, <span class="at">nugget =</span> <span class="cn">NA</span>) <span class="co"># Valores iniciales por defecto, incluyendo nugget</span></span>
<span id="cb94-2"><a href="ajuste-variog.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo &lt;- vgm(psill = 0.6, model = &quot;Exp&quot;, range = 0.2, nugget = 0.0) # Valores iniciales</span></span>
<span id="cb94-3"><a href="ajuste-variog.html#cb94-3" aria-hidden="true" tabindex="-1"></a>fit.ols <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vario, <span class="at">model =</span> modelo, <span class="at">fit.method =</span> <span class="dv">6</span>)</span>
<span id="cb94-4"><a href="ajuste-variog.html#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit.npairs &lt;- fit.variogram(vario, model = modelo, fit.method = 1) # Warning: No convergence</span></span>
<span id="cb94-5"><a href="ajuste-variog.html#cb94-5" aria-hidden="true" tabindex="-1"></a>fit.npairs <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vario, <span class="at">model =</span> fit.ols, <span class="at">fit.method =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning in fit.variogram(vario, model = fit.ols, fit.method = 1): No convergence
## after 200 iterations: try different initial values?</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="ajuste-variog.html#cb96-1" aria-hidden="true" tabindex="-1"></a>fit.lin <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vario, <span class="at">model =</span> modelo, <span class="at">fit.method =</span> <span class="dv">7</span>)</span>
<span id="cb96-2"><a href="ajuste-variog.html#cb96-2" aria-hidden="true" tabindex="-1"></a>fit.cressie <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vario, <span class="at">model =</span> fit.lin, <span class="at">fit.method =</span> <span class="dv">2</span>) </span>
<span id="cb96-3"><a href="ajuste-variog.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Representar:</span></span>
<span id="cb96-4"><a href="ajuste-variog.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuidado con plot.variogramModel() si se pretende añadir elementos</span></span>
<span id="cb96-5"><a href="ajuste-variog.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vario<span class="sc">$</span>dist, vario<span class="sc">$</span>gamma, <span class="at">xlab =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">ylab =</span>  <span class="st">&quot;semivariance&quot;</span>, </span>
<span id="cb96-6"><a href="ajuste-variog.html#cb96-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb96-7"><a href="ajuste-variog.html#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">variogramLine</span>(fit.ols, <span class="at">maxdist =</span> <span class="fl">0.6</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb96-8"><a href="ajuste-variog.html#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">variogramLine</span>(fit.npairs, <span class="at">maxdist =</span> <span class="fl">0.6</span>), <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb96-9"><a href="ajuste-variog.html#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">variogramLine</span>(fit.lin, <span class="at">maxdist =</span> <span class="fl">0.6</span>), <span class="at">lty =</span> <span class="dv">4</span>)</span>
<span id="cb96-10"><a href="ajuste-variog.html#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">variogramLine</span>(fit.cressie, <span class="at">maxdist =</span> <span class="fl">0.6</span>))</span>
<span id="cb96-11"><a href="ajuste-variog.html#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;ols&quot;</span>, <span class="st">&quot;npairs&quot;</span>, <span class="st">&quot;default (linear)&quot;</span>, <span class="st">&quot;cressie&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="03-modelado_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ajuste-variog.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros estimados:</span></span>
<span id="cb97-2"><a href="ajuste-variog.html#cb97-2" aria-hidden="true" tabindex="-1"></a>fit.cressie</span></code></pre></div>
<pre><code>##   model   psill     range
## 1   Nug 0.13495 0.0000000
## 2   Exp 1.15982 0.6403818</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="ajuste-variog.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Error ajuste</span></span>
<span id="cb99-2"><a href="ajuste-variog.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(fit.cressie, <span class="st">&quot;SSErr&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 52.83535</code></pre>
<p>En <code>gstat</code> el ajuste GLS se podría realizar mediante la función:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="ajuste-variog.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.variogram.gls</span>(formula, data, model, <span class="at">maxiter =</span> <span class="dv">30</span>, <span class="at">eps =</span> .<span class="dv">01</span>, </span>
<span id="cb101-2"><a href="ajuste-variog.html#cb101-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">trace =</span> <span class="cn">TRUE</span>, <span class="at">ignoreInitial =</span> <span class="cn">TRUE</span>, <span class="at">cutoff =</span> <span class="cn">Inf</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Sin embargo, actualmente solo admite datos tipo <code>Spatial*</code> del paquete <code>sp</code> y además es habitual que aparezcan problemas computacionales, por lo que no se recomendaría su uso.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="ajuste-variog.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.variogram.gls</span>(z <span class="sc">~</span> <span class="dv">1</span>, <span class="fu">as</span>(datos, <span class="st">&quot;Spatial&quot;</span>), modelo, </span>
<span id="cb102-2"><a href="ajuste-variog.html#cb102-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">maxiter =</span> <span class="dv">2</span>, <span class="at">cutoff =</span> <span class="fl">0.6</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-3"><a href="ajuste-variog.html#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in if (any(model$range &lt; 0)) { :  missing value where TRUE/FALSE needed</span></span></code></pre></div>
</div>
<div id="trend-fit" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Modelado del variograma en procesos no estacionarios</h3>
<p>Como ya se comentó en la introducción de este capítulo, si no se puede asumir que la tendencia es constante no es apropiado utilizar directamente los estimadores del semivariograma mostrados en la Sección <a href="vario-muestrales.html#vario-muestrales">3.1</a>.
Por ejemplo, considerando el modelo lineal de la Sección <a href="geoestadistica.html#modelos-clasicos-espaciales">1.2.1</a> (el modelo del <em>kriging universal</em>, Sección 4.X), tendríamos que:
<span class="math display">\[E(Z(\mathbf{s}_1)-Z(\mathbf{s}_{2}))^2 =2\gamma(\mathbf{s}_1
-\mathbf{s}_{2}) + \left( \sum\limits_{j=0}^{p}\beta_{j}  \left( X_{j}
(\mathbf{s}_1)-X_{j}(\mathbf{s}_{2})\right) \right)^2.\]</span>
El procedimiento habitual en geoestadística es eliminar la tendencia y estimar el variograma a partir de los residuos.</p>
<p>Como ejemplo consideraremos los datos del acuífero Wolfcamp:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="ajuste-variog.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;datos/aquifer.RData&quot;</span>)</span>
<span id="cb103-2"><a href="ajuste-variog.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb103-3"><a href="ajuste-variog.html#cb103-3" aria-hidden="true" tabindex="-1"></a>aquifer<span class="sc">$</span>head <span class="ot">&lt;-</span> aquifer<span class="sc">$</span>head<span class="sc">/</span><span class="dv">100</span> <span class="co"># en cientos de pies</span></span>
<span id="cb103-4"><a href="ajuste-variog.html#cb103-4" aria-hidden="true" tabindex="-1"></a>aquifer_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(aquifer, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">agr =</span> <span class="st">&quot;constant&quot;</span>)</span>
<span id="cb103-5"><a href="ajuste-variog.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># maxlag &lt;- 0.5*sqrt(sum(diff(matrix(st_bbox(aquifer_sf), nrow = 2, byrow = TRUE))^2))</span></span>
<span id="cb103-6"><a href="ajuste-variog.html#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="ajuste-variog.html#cb103-7" aria-hidden="true" tabindex="-1"></a>vario.est <span class="ot">&lt;-</span> <span class="fu">variogram</span>(head <span class="sc">~</span> <span class="dv">1</span>, aquifer_sf, <span class="at">cutoff =</span> <span class="dv">150</span>)</span>
<span id="cb103-8"><a href="ajuste-variog.html#cb103-8" aria-hidden="true" tabindex="-1"></a>vario.trend <span class="ot">&lt;-</span> <span class="fu">variogram</span>(head <span class="sc">~</span> lon <span class="sc">+</span> lat, aquifer_sf, <span class="at">cutoff =</span> <span class="dv">150</span>)    </span>
<span id="cb103-9"><a href="ajuste-variog.html#cb103-9" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb103-10"><a href="ajuste-variog.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(vario.est) # no compatible con mfrow</span></span>
<span id="cb103-11"><a href="ajuste-variog.html#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(vario.est,  <span class="fu">plot</span>(dist, gamma, <span class="at">xlab =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">ylab =</span>  <span class="st">&quot;semivariance&quot;</span>))</span>
<span id="cb103-12"><a href="ajuste-variog.html#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(vario.trend)</span></span>
<span id="cb103-13"><a href="ajuste-variog.html#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(vario.trend,  <span class="fu">plot</span>(dist, gamma, <span class="at">xlab =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">ylab =</span>  <span class="st">&quot;semivariance&quot;</span>))</span></code></pre></div>
<p><img src="03-modelado_files/figure-html/aquifer-var-trend-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="ajuste-variog.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p>El ajuste por WLS se puede realizar también con la función <code>fit.variogram()</code>:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="ajuste-variog.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo &lt;- vgm(psill = 3, model = &quot;Sph&quot;, range = 75, nugget = 0) </span></span>
<span id="cb105-2"><a href="ajuste-variog.html#cb105-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">model =</span> <span class="st">&quot;Sph&quot;</span>, <span class="at">nugget =</span> <span class="cn">NA</span>) <span class="co"># Valores iniciales por defecto</span></span>
<span id="cb105-3"><a href="ajuste-variog.html#cb105-3" aria-hidden="true" tabindex="-1"></a>fit.trend <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(vario.trend, modelo, <span class="at">fit.method =</span> <span class="dv">2</span>)</span>
<span id="cb105-4"><a href="ajuste-variog.html#cb105-4" aria-hidden="true" tabindex="-1"></a>fit.trend</span></code></pre></div>
<pre><code>##   model    psill    range
## 1   Nug 1.095133  0.00000
## 2   Sph 3.044034 63.39438</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="ajuste-variog.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuidado con plot.variogramModel() si se pretende añadir elementos</span></span>
<span id="cb107-2"><a href="ajuste-variog.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(fit.trend, cutoff = 150, ylim = c(0, 4.5))</span></span>
<span id="cb107-3"><a href="ajuste-variog.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># with(vario.trend,  points(dist, gamma))</span></span>
<span id="cb107-4"><a href="ajuste-variog.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(vario.trend, <span class="fu">plot</span>(dist, gamma, <span class="at">xlab =</span> <span class="st">&quot;distance&quot;</span>, </span>
<span id="cb107-5"><a href="ajuste-variog.html#cb107-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ylab =</span>  <span class="st">&quot;semivariance&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>)))</span>
<span id="cb107-6"><a href="ajuste-variog.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">variogramLine</span>(fit.trend, <span class="at">maxdist =</span> <span class="dv">150</span>))</span></code></pre></div>
<p><img src="03-modelado_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Si no se puede asumir que la tendencia es constante, para poder estimarla de forma eficiente sería necesario conocer la dependencia (i.e. conocer <span class="math inline">\(\gamma(\cdot)\)</span>), que dependería a su vez de la estimación de la tendencia.
Para solventar este problema circular Neuman y Jacobson (1984) propusieron una aproximación iterativa, empezar con el estimador OLS de <span class="math inline">\(?\)</span>, estimar el variograma a partir de los residuos, ajustar un modelo de variograma válido, calcular el estimador GLS basado en el modelo ajustado y así sucesivamente hasta convergencia.
En la práctica este procedimiento suele converger en pocas iteraciones (normalmente menos de 5).
En el paquete <code>gstat</code> solo se realiza una iteración (se reestimará la tendencia empleando GLS al calcular las predicciones kriging).</p>
<p>Función <code>gls()</code> del paquete <code>nlme</code>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="ajuste-variog.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gls</span>(model, data, correlation, weights, method, control, ...)</span></code></pre></div>
<p>Problema sesgo variograma…</p>
<p>Otra alternativa sería asumir normalidad y estimar ambos componentes de forma conjunta empleando alguno de los métodos basados en máxima verosimilitud descritos en la Sección <a href="ajuste-variog.html#ml-fit">3.3.3</a>.</p>
</div>
<div id="ml-fit" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Estimación por máxima verosimilitud</h3>
</div>
<div id="comentarios-sobre-los-distintos-métodos" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Comentarios sobre los distintos métodos</h3>
<!-- 
## Referencias

Pendiente: añadir bibliografía bibtex y referencias paquetes
-->

</div>
</div>
<!-- </div> -->
<div class="footnotes">
<hr />
<ol start="13">
<li id="fn13"><p>La distribución y eficiencia asintótica de los estimadores mínimo cuadráticos ha sido estudiada por Lahiri et al. (2003), demostrando su consistencia y normalidad asintótica bajo condiciones muy generales.<a href="ajuste-variog.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modelos-variog.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="kriging.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rubenfcasal/estadistica_espacial/edit/master/03-modelado.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["estadistica_espacial.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
